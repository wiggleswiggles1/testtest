<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>English Kick TTS Custom</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Inter', sans-serif; background: #0e0e10; color: #efeff1; line-height: 1.6; min-height: 100vh; }
        .container { max-width: 1000px; margin: 0 auto; padding: 40px 20px; }
        header { text-align: center; margin-bottom: 50px; padding: 40px; background: #18181b; border-radius: 12px; border: 2px solid #53fc18; box-shadow: 0 0 30px rgba(83, 252, 24, 0.1); }
        h1 { font-size: 2.8em; font-weight: 700; background: linear-gradient(135deg, #53fc18 0%, #3dd80a 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .subtitle { font-size: 1.1em; color: #adadb8; margin-top: 10px; }
        .generator { background: #1f1f23; padding: 40px; border-radius: 12px; border: 2px solid #53fc18; }
        .form-group { margin-bottom: 28px; }
        label { display: block; margin-bottom: 10px; font-weight: 500; }
        input, select { width: 100%; padding: 14px; background: #0e0e10; border: 2px solid #2d2d35; border-radius: 8px; color: #efeff1; }
        button { background: linear-gradient(135deg, #53fc18 0%, #3dd80a 100%); color: #0e0e10; border: none; padding: 16px; border-radius: 8px; cursor: pointer; width: 100%; font-weight: 700; text-transform: uppercase; }
        .result { background: rgba(83, 252, 24, 0.08); padding: 25px; border-radius: 8px; margin-top: 25px; border: 2px solid #53fc18; display: none; }
        .url-display { background: #0e0e10; padding: 16px; border-radius: 8px; word-break: break-all; color: #53fc18; font-family: monospace; margin: 15px 0; }
        .checkbox-item { background: #0e0e10; border: 2px solid #2d2d35; border-radius: 8px; padding: 14px; margin-bottom: 8px; display: flex; align-items: center; gap: 10px; }
        .hidden { display: none; }
    </style>
</head>
<body>
    <div class="container" id="readme">
        <header>
            <h1>Kick English TTS</h1>
            <p class="subtitle">Custom Text-to-Speech for Kick.com Streamers</p>
        </header>

        <div class="generator">
            <h2>TTS Link Generator</h2>
            <div class="form-group">
                <label for="channel">Kick Channel Name (Required)</label>
                <input type="text" id="channel" placeholder="e.g. your_username" required>
            </div>

            <div class="form-group">
                <label for="voice">Voice Selection</label>
                <select id="voice">
                    <optgroup label="StreamElements (Best)">
                        <option value="Brian">Brian (UK Male)</option>
                        <option value="Amy">Amy (UK Female)</option>
                        <option value="Joey">Joey (US Male)</option>
                        <option value="Salli">Salli (US Female)</option>
                    </optgroup>
                    <optgroup label="Google TTS">
                        <option value="GoogleEN">Google English</option>
                    </optgroup>
                </select>
            </div>

            <div class="form-group">
                <label>Options</label>
                <div class="checkbox-item">
                    <input type="checkbox" id="readnick">
                    <label for="readnick">Read username before message</label>
                </div>
                <div class="checkbox-item">
                    <input type="checkbox" id="pretext" checked>
                    <label for="pretext">Require "tts" command at start</label>
                </div>
            </div>

            <button onclick="generateURL()">Generate TTS Link</button>

            <div class="result" id="result">
                <h3>Your TTS Link:</h3>
                <div class="url-display" id="url-display"></div>
                <button onclick="copyURL()">Copy Link</button>
            </div>
        </div>
    </div>

    <script src="https://js.pusher.com/8.0.1/pusher.min.js"></script>

    <script>
        let queue = [];
        let isPlaying = false;
        let currentAudio = null;

        // 1. GENERATOR LOGIC
        function generateURL() {
            const channel = document.getElementById('channel').value.trim();
            if (!channel) return alert("Enter channel name!");

            const params = new URLSearchParams({
                channel: channel,
                voice: document.getElementById('voice').value,
                readnick: document.getElementById('readnick').checked ? 'on' : 'off',
                pretext: document.getElementById('pretext').checked ? 'on' : 'off',
                volume: 80
            });

            const link = window.location.origin + window.location.pathname + '?' + params.toString();
            document.getElementById('url-display').innerText = link;
            document.getElementById('result').style.display = 'block';
        }

        function copyURL() {
            navigator.clipboard.writeText(document.getElementById('url-display').innerText);
            alert("Copied to clipboard!");
        }

        // 2. TTS ENGINE LOGIC (The "Brain")
        const urlParams = new URLSearchParams(window.location.search);
        if (urlParams.has('channel')) {
            document.getElementById('readme').classList.add('hidden');
            initTTS(urlParams);
        }

        async function initTTS(params) {
            const channelName = params.get('channel').toLowerCase();
            const voice = params.get('voice') || 'Brian';
            const requireCommand = params.get('pretext') === 'on';
            const readNick = params.get('readnick') === 'on';

            // Get Kick Room ID via API
            try {
                const response = await fetch(`https://kick.com/api/v1/channels/${channelName}`);
                const data = await response.json();
                const chatRoomId = data.chatroom.id;

                const pusher = new Pusher('eb1d5f283082fdc784d7', { cluster: 'us2' });
                const channel = pusher.subscribe(`chatrooms.${chatRoomId}.v2`);

                channel.bind('App\\Events\\ChatMessageEvent', (data) => {
                    let msg = data.content;
                    let sender = data.sender.username;

                    // Skip bot messages
                    if (sender.toLowerCase().includes('bot')) return;

                    // Handle !skiptts command
                    if (msg === '!skiptts' && (data.sender.identity.badges.some(b => b.type === 'broadcaster'))) {
                        skipTTS();
                        return;
                    }

                    if (requireCommand) {
                        if (!msg.toLowerCase().startsWith('tts ')) return;
                        msg = msg.substring(4);
                    }

                    const fullText = readNick ? `${sender} says ${msg}` : msg;
                    addToQueue(fullText, voice);
                });
            } catch (e) {
                console.error("Could not connect to Kick chat", e);
            }
        }

        function addToQueue(text, voice) {
            queue.push({ text, voice });
            processQueue();
        }

        async function processQueue() {
            if (isPlaying || queue.length === 0) return;
            isPlaying = true;
            const item = queue.shift();

            // StreamElements TTS API (English)
            const url = `https://api.streamelements.com/kappa/v2/speech?voice=${item.voice}&text=${encodeURIComponent(item.text)}`;
            
            currentAudio = new Audio(url);
            currentAudio.volume = (urlParams.get('volume') || 80) / 100;
            currentAudio.onended = () => {
                isPlaying = false;
                processQueue();
            };
            currentAudio.play().catch(() => {
                isPlaying = false;
                processQueue();
            });
        }

        function skipTTS() {
            if (currentAudio) {
                currentAudio.pause();
                isPlaying = false;
                processQueue();
            }
        }
    </script>
</body>
</html>